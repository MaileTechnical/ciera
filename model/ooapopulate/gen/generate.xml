<?xml version="1.0" encoding="UTF-8"?>
<project name="ooapopulate" default="all" basedir=".">

    <property name="eclipse.home" value="/Users/levistarrett/xtuml/m621.jar_loader/BridgePoint.app/Contents/Eclipse" />
    <property name="xtumlmc_build" value="${eclipse.home}/tools/mc/bin/xtumlmc_build"/>

    <target name="all" depends="preprocess,cleanse,create_populate"></target>

    <property name="prebuilder.output" value="code_generation/ooapopulate.sql" />
    <property name="sql.input.dir" value="code_generation/xtuml" />
    <property name="sql.input" value="${sql.input.dir}/a.xtuml" />
    <property name="sql.output" value="code_generation/ooapopulate.xtuml" />
    <property name="sql.output.dir" value="code_generation" />

    <target name="preprocess">
        <mkdir dir="${sql.input.dir}"/>
        <move file="${prebuilder.output}" tofile="${sql.input}"/>
    </target>

    <property name="cleanse.commandline" value="xtumlmc_cleanse_for_BridgePoint -u 500000 ${sql.input.dir} ${sql.output}" />
    <target name="cleanse">
        <echo >Eclipse home: ${eclipse.home}</echo> 
        <echo >${xtumlmc_build} ${cleanse.commandline}</echo> 
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}" >
            <arg line="${cleanse.commandline}" />
        </exec>
    </target>

    <property name="populate.output" value="lib/POPULATE.java" />

    <target name="create_populate.depends" >
        <uptodate property="create_populate.buildNotNeeded" targetfile="../src/${populate.output}">
            <srcfiles dir="${sql.output.dir}" includes="*.xtuml"/>
        </uptodate>
    </target>

    <property name="schema.path" value="${eclipse.home}/tools/mc/schema/sql/xtumlmc_schema.sql"/>
    <property name="create_populate.commandline" value="
        xtumlmc_gen_erate -nopersist
        -import ${schema.path}
        -import ${sql.output}
        -arch ../arc/create_populate.arc" />
    <target name="create_populate"
                depends="create_populate.depends"
                unless="create_populate.buildNotNeeded" >
        <echo>Generating ${populate.output} ...</echo>
        <echo>${xtumlmc_build} ${create_populate.commandline}</echo>
        <exec vmlauncher="false" failonerror="true" executable="${xtumlmc_build}">
            <env key="XTUMLMC_HOME" value="${eclipse.home}/tools" />
            <arg line="${create_populate.commandline}"/>
        </exec>
    </target>
	
	<target name="clean">
		<delete file="../src/${populate.output}"/>
	</target>

</project>
